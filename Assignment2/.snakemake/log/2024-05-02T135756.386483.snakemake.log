Building DAG of jobs...
Using shell: /lustre1/project/stg_00079/teaching/I0U19a_conda_2024/bin/bash
Provided cluster nodes: 22
Job stats:
job             count
------------  -------
all                 1
extract_snps        1
snp_heatmap         1
total               3

Select jobs to execute...

[Thu May  2 13:57:57 2024]
localrule extract_snps:
    input: 5_snpeff/snps.annotated.vcf
    output: genes.vcf
    jobid: 37
    reason: Missing output files: genes.vcf
    resources: mem_mb=1000, mem_mib=954, disk_mb=1000, disk_mib=954, tmpdir=/tmp

RuleException in rule extract_snps in file /vsc-hard-mounts/leuven-data/362/vsc36251/Assignment2/snakefile, line 248:
NameError: The name 'bcftools_cmd' is unknown in this context. Please make sure that you defined that variable. Also note that braces not used for variable access have to be escaped by repeating them, i.e. {{print $1}}, when formatting the following:

        # Construct the bcftools view command dynamically
        bcftools_cmd = "bcftools view -i '"
        
        # Construct the filter expression based on gene names
        filter_expr = " | ".join([f'INFO/ANN ~ "|{{gene}}-" | INFO/ANN ~ "-{{gene}}|" for gene in gene_names])
        
        # Complete the bcftools command
        bcftools_cmd += filter_expr + "' {input.vcf} > {output.genes_vcf}"
        
        # Execute the constructed command
        {bcftools_cmd}
        
        # Check if there are more lines than just the header in the output VCF file
        if ! [ $(grep -c "^#" {output.genes_vcf}) -eq $(grep -c "^#" {input.vcf}) ]; then
            echo "Error: Output VCF file contains only header"
            false
        fi
        
